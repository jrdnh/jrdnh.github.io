






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="rgb(255,255,255)" />
  
  <title>Pydantic With Third Party Types &middot; jrdnh</title>
    <meta name="title" content="Pydantic With Third Party Types &middot; jrdnh" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js"
    integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.846491e439ce18551a5c80d168997b32ad65350132e38fc9420189984a3e1a31.css"
    integrity="sha256-hGSR5DnOGFUaXIDRaJl7Mq1lNQEy44/JQgGJmEo&#43;GjE="
  />
  
    
    
    
  
  
  
    
    
  
  
    
    
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.5b9218820e6c6b9f04b4c5a03dffd0d57bc9189f511ee80ea74222de3a608e2f.js"
      integrity="sha256-W5IYgg5sa58EtMWgPf/Q1XvJGJ9RHugOp0Ii3jpgji8="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        Validating and structuring data models with Pydantic is a breeze, until you need to use incompatible third-party data types.
      
    "
  />
  
  
  
  <link rel="canonical" href="https://jrdnh.github.io/posts/pydantic-with-third-party-types/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:title" content="Pydantic With Third Party Types" />
<meta property="og:description" content="Validating and structuring data models with Pydantic is a breeze, until you need to use incompatible third-party data types." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jrdnh.github.io/posts/pydantic-with-third-party-types/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-13T21:52:40-05:00" />
<meta property="article:modified_time" content="2023-12-13T21:52:40-05:00" />


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Pydantic With Third Party Types"/>
<meta name="twitter:description" content="Validating and structuring data models with Pydantic is a breeze, until you need to use incompatible third-party data types."/>

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Pydantic With Third Party Types",
    "headline": "Pydantic With Third Party Types",
    
    "abstract": "Validating and structuring data models with Pydantic is a breeze, until you need to use incompatible third-party data types.",
    "inLanguage": "en",
    "url" : "https:\/\/jrdnh.github.io\/posts\/pydantic-with-third-party-types\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-12-13T21:52:40-05:00",
    "datePublished": "2023-12-13T21:52:40-05:00",
    
    "dateModified": "2023-12-13T21:52:40-05:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1894"
  }
  </script>


  
  
  
  
  






  
  
  
  
    <script
      defer
      data-domain="jrdnh.github.io"
      data-api="https://plausible.io/api/event"
      src="https://plausible.io/js/script.js"
    ></script>
  
  


  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="z-40 flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >jrdnh</a
  >

    </div>
    
      
      <label id="menu-button" for="menu-controller" class="block sm:hidden">
        <input type="checkbox" id="menu-controller" class="hidden" />
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"
        >
          <ul
            class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"
          >
            <li class="mb-1">
              <span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"
                ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span></span
              >
            </li>
            
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/posts/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Posts</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="https://github.com/jrdnh"
                      title=""
                      onclick="close_menu()"
                      target="_blank"
                      >
                        <span
                          class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                        ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    
                      <button
                        id="search-button-1"
                        title="Search (/)"
                      >
                        
                          <span
                            class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                          ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </button>
                    
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    <button
                      id="appearance-switcher-1"
                      type="button"
                      aria-label="appearance switcher"
                    >
                      <span
                        class="group-dark:hover:text-primary-400 inline transition-colors group-hover:text-primary-600 dark:hidden"
                        title="Switch to dark appearance"
                      >
                        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </span>
                      <span
                        class="group-dark:hover:text-primary-400 hidden transition-colors group-hover:text-primary-600 dark:inline"
                        title="Switch to light appearance"
                      >
                        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </span>
                    </button>
                  
                </li>
              
              
            
          </ul>
        </div>
      </label>
      
      <ul class="hidden list-none flex-row text-end sm:flex">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/posts/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Posts</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="https://github.com/jrdnh"
                  title=""
                  target="_blank"
                  >
                    <span
                      class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                
                  <button
                    id="search-button-2"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                <button
                  id="appearance-switcher-2"
                  type="button"
                  aria-label="appearance switcher"
                >
                  <span
                    class="group-dark:hover:text-primary-400 inline transition-colors group-hover:text-primary-600 dark:hidden"
                    title="Switch to dark appearance"
                  >
                    <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </span>
                  <span
                    class="group-dark:hover:text-primary-400 hidden transition-colors group-hover:text-primary-600 dark:inline"
                    title="Switch to light appearance"
                  >
                    <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </span>
                </button>
              
            </li>
          
          

        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Pydantic With Third Party Types
      </h1>
      
        <div class="mb-12 mt-8 text-base text-neutral-500 print:hidden dark:text-neutral-400">
          





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2023-12-13 21:52:40 -0500 EST">13 December 2023</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">9 mins</span>
    

    
    
  </div>

  
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
        <div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8">
          <div class="toc pe-5 print:hidden lg:sticky lg:top-10">
            <details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5">
  <summary
    class="-ms-5 block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 lg:hidden dark:bg-neutral-700 dark:text-neutral-100"
  >
    Table of Contents
  </summary>
  <div class="-ms-5 border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#exploring-relativedelta">Exploring <code>relativedelta</code></a></li>
    <li><a href="#make-weekday-pydantic-compatible">Make <code>weekday</code> Pydantic compatible</a>
      <ul>
        <li><a href="#1-create-a-pydantic-model-for-weekday">1. Create a Pydantic model for <code>weekday</code></a></li>
        <li><a href="#2-modify-the-weekdayannotations-validation-method">2. Modify the <code>WeekdayAnnotations</code> validation method</a></li>
        <li><a href="#3-add-metadata-to-weekday">3. Add metadata to <code>weekday</code></a></li>
      </ul>
    </li>
    <li><a href="#make-relativedelta-pydantic-compatible">Make <code>relativedelta</code> Pydantic compatible</a>
      <ul>
        <li><a href="#1-create-a-pydantic-model-for-relativedelta">1. Create a Pydantic model for <code>relativedelta</code></a></li>
        <li><a href="#2-modify-relativedeltaannotation-validation-method">2. Modify <code>RelativeDeltaAnnotation</code> validation method</a></li>
        <li><a href="#3-add-metadata-to-relativedelta">3. Add metadata to <code>relativedelta</code></a></li>
      </ul>
    </li>
    <li><a href="#alternative-approaches">Alternative approaches</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <p>Validating and structuring data models with 
<a href="https://docs.pydantic.dev/latest/" target="_blank" rel="noreferrer">Pydantic</a> is a breeze, until you need to use incompatible third-party data types. This post walks through the process of making the <code>dateutil.relativedelta.relativedelta</code> type from the widely-used 
<a href="https://github.com/dateutil/dateutil" target="_blank" rel="noreferrer"><code>python-dateutil</code></a> package fully Pydantic-compatible, including JSON schemas.</p>
<hr>
<p>There are several straight-forward approaches if you only need to 
<a href="https://docs.pydantic.dev/latest/concepts/validators/" target="_blank" rel="noreferrer">validate</a> or 
<a href="https://docs.pydantic.dev/latest/concepts/serialization/" target="_blank" rel="noreferrer">serialize</a> custom types. It gets tricker if you also want schemas. The process here follows the principles from the Pydantic 
<a href="https://docs.pydantic.dev/latest/concepts/types/#customizing-validation-with-__get_pydantic_core_schema__" target="_blank" rel="noreferrer">documentation</a>:</p>
<ol>
<li>Create a Pydantic model that represents the third-party type</li>
<li>Modify the model&rsquo;s validation function to return an instance of the <em>third-party</em> type</li>
<li>Add metadata to the third-party type that tells Pydantic how to validate, serialize, and generate schemas for it</li>
</ol>
<hr>
<h2 id="exploring-relativedelta" class="relative group">Exploring <code>relativedelta</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#exploring-relativedelta" aria-label="Anchor">#</a></span></h2><p><code>relativedelta</code> is a date offset type. It&rsquo;s similar to the <code>datetime.timedelta</code> type, but it includes other relative offsets such as <code>years</code> and <code>months</code> as well absolute offests such as the year or the calendar day of the month. Relative offsets end with an &ldquo;s&rdquo; (e.g. <code>month=1</code> offsets to January, <code>months=1</code> increments by one month).</p>
<p>The internal state of a <code>relativedelta</code> object is a dictionary with the following keys:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">relativedelta</span><span class="p">()</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># {</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;years&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;months&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;days&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;leapdays&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;hours&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;minutes&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;seconds&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;microseconds&#34;: 0,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;year&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;month&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;day&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;hour&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;minute&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;second&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;microsecond&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;weekday&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;_has_time&#34;: 0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># }</span>
</span></span></code></pre></div><p>We can ignore <code>_has_time</code> which is set at initialization. All of the other attributes are (optional) <code>int</code>s except for <code>weekday</code> which is a <code>dateutil._common.weekday</code> object. In order to make <code>relativedelta</code> Pydantic compatible, we should also make <code>weekday</code> Pydantic compatible.</p>
<h2 id="make-weekday-pydantic-compatible" class="relative group">Make <code>weekday</code> Pydantic compatible <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#make-weekday-pydantic-compatible" aria-label="Anchor">#</a></span></h2><h3 id="1-create-a-pydantic-model-for-weekday" class="relative group">1. Create a Pydantic model for <code>weekday</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-create-a-pydantic-model-for-weekday" aria-label="Anchor">#</a></span></h3><p><code>weekday</code> uses 
<a href="https://docs.python.org/3/reference/datamodel.html#slots" target="_blank" rel="noreferrer">slots</a> and has the following state:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dateutil._common</span> <span class="kn">import</span> <span class="n">weekday</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weekday</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="vm">__slots__</span>
</span></span><span class="line"><span class="cl"><span class="c1"># [&#39;weekday&#39;, &#39;n&#39;]</span>
</span></span></code></pre></div><p>The first step is to create a Pydantic model that represents <code>weekday</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WeekdayAnnotations</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">weekday</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span></code></pre></div><p>The <code>weekday</code> attribute is the day of the week, so it must be bounded by 0 and 6. <code>n</code> is the offset for number of weeks (e.g. <code>{weekday: 0, n: 2}</code> is the second Monday after the current date). <code>n</code> is optional and unbounded.</p>
<h3 id="2-modify-the-weekdayannotations-validation-method" class="relative group">2. Modify the <code>WeekdayAnnotations</code> validation method <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-modify-the-weekdayannotations-validation-method" aria-label="Anchor">#</a></span></h3><p>The <code>model_validator</code> decorator can be used to hook into the validate process. 
<a href="https://docs.pydantic.dev/latest/api/functional_validators/#pydantic.functional_validators.model_validator" target="_blank" rel="noreferrer"><code>model_validator</code></a> has several modes which allow you to determine when and how customized validation occurs.</p>
<p>In this case, if the user passes in an instance of the <code>dateutil._common.weekday</code> type, we don&rsquo;t need to do any more validation and will return it immediately. Otherwise, we want to run the normal Pydantic validation logic on the value that was passed in (i.e. make sure there is a <code>weekday</code> attribute that has an integer value between 0 and 6, etc.). The <code>&quot;wrap&quot;</code> mode passes a <code>handler</code> function as the second argument. The <code>handler</code> function calls the next validation step. In other words, it will call the normal model validation logic.</p>
<p>The return value from the <code>handler</code> will either be a <code>WeekdayAnnotations</code> object or a <code>dateutil._common.weekday</code> object. If it is a <code>WeekdayAnnotations</code> object, we need to convert it to a <code>dateutil._common.weekday</code> object.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">model_validator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WeekdayAnnotations</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">weekday</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&#34;wrap&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relativedelta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># if already dateutil._common.weekday instance, return it</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">weekday</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># otherwise run model validation which returns either a</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># a WeekdayAnnotations or dateutil._common.weekday object</span>
</span></span><span class="line"><span class="cl">        <span class="n">validated</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validated</span><span class="p">,</span> <span class="n">weekday</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">validated</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">weekday</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span></code></pre></div><p>For types that use <code>__slots__</code>, we also need to define a serialization function.</p>
<blockquote>
<p><strong>Note</strong>: Defining a serialization function is only required for types that use <code>__slots__</code>. It is not required for most types that use the typical <code>__dict__</code> structure. There isn&rsquo;t a clear reason for this behavior as far as I can 
<a href="https://github.com/pydantic/pydantic/discussions/8351" target="_blank" rel="noreferrer">tell</a>.</p>
</blockquote>
<p>Defining a 
<a href="https://docs.pydantic.dev/latest/api/functional_serializers/#pydantic.functional_serializers.model_serializer" target="_blank" rel="noreferrer">serialization</a> function is similar defining a validation function, except the serialization modes are different. We&rsquo;ll use the <code>&quot;plain&quot;</code> mode which just replaces the built-in serializtion process the our custom function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">model_serializer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WeekdayAnnotations</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@model_serializer</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&#34;plain&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">weekday</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;weekday&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">weekday</span><span class="p">,</span> <span class="s2">&#34;n&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">}</span>
</span></span></code></pre></div><p>Note that the first argument to our serialization function <em>must</em> be named <code>self</code> when using the <code>@model_serializer</code> decorator. The custom function just returns a <code>dict</code> with the <code>weekday</code> and <code>n</code> attributes.</p>
<h3 id="3-add-metadata-to-weekday" class="relative group">3. Add metadata to <code>weekday</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-add-metadata-to-weekday" aria-label="Anchor">#</a></span></h3><p>The final step is to tell Pydantic to use the validation, serialization, and schema generation logic contained in the <code>WeekdayAnnotations</code> model for the <code>dateutil._common.weekday</code> type. We can do this by adding metadata to the <code>weekday</code> type using <code>Annotated</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Weekday</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">weekday</span><span class="p">,</span> <span class="n">WeekdayAnnotations</span><span class="p">]</span>
</span></span></code></pre></div><p>If you examine <code>Weekday</code>&rsquo;s metadata, you&rsquo;ll see that it contains the <code>WeekdayAnnotations</code> model.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Weekday</span><span class="o">.</span><span class="n">__metadata__</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (&lt;class &#39;__main__.WeekdayAnnotations&#39;&gt;,)</span>
</span></span></code></pre></div><p>Now we can use <code>Weekday</code> directly using <code>pydantic.TypeAdapter</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">TypeAdapter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WeekdayAdapter</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">Weekday</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">WeekdayAdapter</span><span class="o">.</span><span class="n">json_schema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># {&#39;properties&#39;: {&#39;weekday&#39;: {&#39;maximum&#39;: 6, &#39;minimum&#39;: 0, &#39;title&#39;: &#39;Weekday&#39;, &#39;type&#39;: &#39;integer&#39;}, &#39;n&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;N&#39;}}, &#39;required&#39;: [&#39;weekday&#39;], &#39;title&#39;: &#39;WeekdayAnnotations&#39;, &#39;type&#39;: &#39;object&#39;}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_day</span> <span class="o">=</span> <span class="n">WeekdayAdapter</span><span class="o">.</span><span class="n">validate_python</span><span class="p">({</span><span class="s2">&#34;weekday&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;n&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">WeekdayAdapter</span><span class="o">.</span><span class="n">dump_python</span><span class="p">(</span><span class="n">my_day</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># {&#39;weekday&#39;: 2, &#39;n&#39;: 2}</span>
</span></span></code></pre></div><p>Notice that values returned by <code>WeekdayAdapter.validate_python</code> are pure <code>dateutil._common.weekday</code> objects, they are <em>not</em> any sort of wrapped object.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span><span class="n">my_day</span><span class="p">)</span> <span class="o">==</span> <span class="n">weekday</span>
</span></span><span class="line"><span class="cl"><span class="c1"># True</span>
</span></span></code></pre></div><p><code>Weekday</code> can also be used as a field type in other Pydantic models. Again, the attribute types will be preserved as straight <code>dateutil._common.weekday</code> types. Since our validator accepts both <code>dict</code>s and <code>dateutil._common.weekday</code> objects, we can pass either into the model constructor as well.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">day</span><span class="p">:</span> <span class="n">Weekday</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Foo</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;weekday&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;n&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Foo(day=WE(+3))</span>
</span></span><span class="line"><span class="cl"><span class="n">Foo</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="n">weekday</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Foo(day=WE(+3))</span>
</span></span><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="n">weekday</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="o">==</span> <span class="n">weekday</span>
</span></span><span class="line"><span class="cl"><span class="c1"># True</span>
</span></span></code></pre></div><h2 id="make-relativedelta-pydantic-compatible" class="relative group">Make <code>relativedelta</code> Pydantic compatible <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#make-relativedelta-pydantic-compatible" aria-label="Anchor">#</a></span></h2><p>Using the <code>Weekday</code> type we just created, we can follow the same process to make <code>relativedelta</code> compatible with Pydantic.</p>
<h3 id="1-create-a-pydantic-model-for-relativedelta" class="relative group">1. Create a Pydantic model for <code>relativedelta</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-create-a-pydantic-model-for-relativedelta" aria-label="Anchor">#</a></span></h3><p>If you look at the <code>dateutil</code> 
<a href="https://dateutil.readthedocs.io/en/stable/relativedelta.html" target="_blank" rel="noreferrer">documentation</a>, there are several additional fields that may be used in the <code>relativedelta</code> constructor which are converted in initialization. These are: <code>weeks</code> (converted to <code>days</code>), <code>yearday</code> and <code>nlyearday</code> (converted to <code>day</code>/<code>month</code>/<code>leapdays</code>). Finally, a <code>relativedelta</code> object can be created by passing two dates spanning the offset interval. The <code>relativedelta</code> object will be the difference between the two dates.</p>
<p>The full corresponding Pydantic model looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RelativeDeltaAnnotation</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">years</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">months</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">microseconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># recommended way to avoid potential errors for compound types with constraints</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://docs.pydantic.dev/dev/concepts/fields/#numeric-constraints</span>
</span></span><span class="line"><span class="cl">    <span class="n">month</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">12</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">day</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">31</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">23</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">minute</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">59</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">second</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">59</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">microsecond</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">999999</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">weekday</span><span class="p">:</span> <span class="n">Weekday</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">leapdays</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># validation only fields</span>
</span></span><span class="line"><span class="cl">    <span class="n">yearday</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">nlyearday</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">weeks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dt1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dt2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></div><p>Note that the validation-only fields have <code>exclude=True</code> so that they are <em>not</em> included in the serialization schema. They <em>will</em> still be included in the validation schema.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic.json_schema</span> <span class="kn">import</span> <span class="n">model_json_schema</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SchemaTest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">validation_only</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Validation schema includes validation-only fields</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">SchemaTest</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># {</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;properties&#34;: {</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     &#34;validation_only&#34;: {</span>
</span></span><span class="line"><span class="cl"><span class="c1">#       &#34;default&#34;: null,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#       &#34;title&#34;: &#34;Validation Only&#34;,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#       &#34;type&#34;: &#34;null&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     }</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   },</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;title&#34;: &#34;SchemaTest&#34;,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;type&#34;: &#34;object&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># }</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Serialization schema does not include validation-only fields</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">SchemaTest</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;serialization&#39;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># {</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;properties&#34;: {},</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;title&#34;: &#34;SchemaTest&#34;,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   &#34;type&#34;: &#34;object&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># }</span>
</span></span></code></pre></div><h3 id="2-modify-relativedeltaannotation-validation-method" class="relative group">2. Modify <code>RelativeDeltaAnnotation</code> validation method <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-modify-relativedeltaannotation-validation-method" aria-label="Anchor">#</a></span></h3><p>Similar to the <code>WeekdayAnnotations</code> model, we need to modify the validation function to return the third-party type instead of the Pydantic model.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">core_schema</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RelativeDeltaAnnotation</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&#34;wrap&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">ValidatorFunctionWrapHandler</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relativedelta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">validated</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validated</span><span class="p">,</span> <span class="n">relativedelta</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">validated</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">relativedelta</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span></code></pre></div><p>Since the <code>relativedelta</code> does <em>not</em> use <code>__slots__</code>, we don&rsquo;t need to define a custom serialization function.</p>
<h3 id="3-add-metadata-to-relativedelta" class="relative group">3. Add metadata to <code>relativedelta</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-add-metadata-to-relativedelta" aria-label="Anchor">#</a></span></h3><p>Finally, we can use <code>Annotated</code> again to add metadata to the <code>relativedelta</code> type.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RelativeDelta</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">relativedelta</span><span class="p">,</span> <span class="n">RelativeDeltaAnnotation</span><span class="p">]</span>
</span></span></code></pre></div><p>Just like <code>Weekday</code>, <code>RelativeDelta</code> fields will resolve to pure <code>relativedelta</code> objects. <code>RelativeDelta</code> field annotations can be used in Pydantic models to provide full validation, serialization, <em>and</em> schema generation support while the actual model attributes remain <code>relativedelta</code> objects.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">TU</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RecurringPayment</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">amount</span><span class="p">:</span> <span class="nb">float</span>
</span></span><span class="line"><span class="cl">    <span class="n">origination</span><span class="p">:</span> <span class="n">date</span>
</span></span><span class="line"><span class="cl">    <span class="n">frequency</span><span class="p">:</span> <span class="n">RelativeDelta</span>
</span></span><span class="line"><span class="cl">    <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">payments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periods</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">origination</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mortgage</span> <span class="o">=</span> <span class="n">RecurringPayment</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">origination</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                            <span class="n">frequency</span><span class="o">=</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                            <span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="n">mortgage</span><span class="o">.</span><span class="n">payments</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># [datetime.date(2020, 1, 1), datetime.date(2020, 2, 1), ...]</span>
</span></span><span class="line"><span class="cl"><span class="n">mortgage</span><span class="o">.</span><span class="n">frequency</span>
</span></span><span class="line"><span class="cl"><span class="c1"># relativedelta(months=+1)</span>
</span></span><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span><span class="n">mortgage</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;class &#39;dateutil.relativedelta.relativedelta&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">mortgage</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#39;{&#34;amount&#34;:100.0,&#34;origination&#34;:&#34;2020-01-01&#34;,&#34;frequency&#34;:{&#34;years&#34;:0,&#34;months&#34;:1,&#34;days&#34;:0,&#34;leapdays&#34;:0,&#34;hours&#34;:0,&#34;minutes&#34;:0,&#34;seconds&#34;:0,&#34;microseconds&#34;:0,&#34;year&#34;:null,&#34;month&#34;:null,&#34;day&#34;:null,&#34;hour&#34;:null,&#34;minute&#34;:null,&#34;second&#34;:null,&#34;microsecond&#34;:null,&#34;weekday&#34;:null},&#34;periods&#34;:12}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">RecurringPayment</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&#34;serialization&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#{&#39;$defs&#39;: {&#39;RelativeDeltaAnnotation&#39;: {&#39;properties&#39;: {&#39;years&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Years&#39;}, &#39;months&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Months&#39;}, &#39;days&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Days&#39;}, &#39;hours&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Hours&#39;}, &#39;minutes&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Minutes&#39;}, &#39;seconds&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Seconds&#39;}, &#39;microseconds&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Microseconds&#39;}, &#39;year&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Year&#39;}, &#39;month&#39;: {&#39;anyOf&#39;: [{&#39;maximum&#39;: 12, &#39;minimum&#39;: 1, &#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Month&#39;}, &#39;day&#39;: {&#39;anyOf&#39;: [{&#39;maximum&#39;: 31, &#39;minimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Day&#39;}, &#39;hour&#39;: {&#39;anyOf&#39;: [{&#39;maximum&#39;: 23, &#39;minimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Hour&#39;}, &#39;minute&#39;: {&#39;anyOf&#39;: [{&#39;maximum&#39;: 59, &#39;minimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Minute&#39;}, &#39;second&#39;: {&#39;anyOf&#39;: [{&#39;maximum&#39;: 59, &#39;minimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Second&#39;}, &#39;microsecond&#39;: {&#39;anyOf&#39;: [{&#39;maximum&#39;: 999999, &#39;minimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Microsecond&#39;}, &#39;weekday&#39;: {&#39;anyOf&#39;: [{&#39;$ref&#39;: &#39;#/$defs/WeekdayAnnotations&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None}, &#39;leapdays&#39;: {&#39;anyOf&#39;: [{&#39;type&#39;: &#39;integer&#39;}, {&#39;type&#39;: &#39;null&#39;}], &#39;default&#39;: None, &#39;title&#39;: &#39;Leapdays&#39;}}, &#39;title&#39;: &#39;RelativeDeltaAnnotation&#39;, &#39;type&#39;: &#39;object&#39;}, &#39;WeekdayAnnotations&#39;: {&#39;title&#39;: &#39;WeekdayAnnotations&#39;, &#39;type&#39;: &#39;object&#39;}}, &#39;properties&#39;: {&#39;amount&#39;: {&#39;title&#39;: &#39;Amount&#39;, &#39;type&#39;: &#39;number&#39;}, &#39;origination&#39;: {&#39;format&#39;: &#39;date&#39;, &#39;title&#39;: &#39;Origination&#39;, &#39;type&#39;: &#39;string&#39;}, &#39;frequency&#39;: {&#39;$ref&#39;: &#39;#/$defs/RelativeDeltaAnnotation&#39;}, &#39;periods&#39;: {&#39;title&#39;: &#39;Periods&#39;, &#39;type&#39;: &#39;integer&#39;}}, &#39;required&#39;: [&#39;amount&#39;, &#39;origination&#39;, &#39;frequency&#39;, &#39;periods&#39;], &#39;title&#39;: &#39;RecurringPayment&#39;, &#39;type&#39;: &#39;object&#39;}</span>
</span></span></code></pre></div><h2 id="alternative-approaches" class="relative group">Alternative approaches <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#alternative-approaches" aria-label="Anchor">#</a></span></h2><p>This approach uses the <code>@model_validator</code> decorator to provide an updated validation function that returns the third-party type. The Pydantic documentation uses a 
<a href="https://docs.pydantic.dev/latest/concepts/types/#handling-third-party-types" target="_blank" rel="noreferrer">different</a> hook into the validation process (<code>__get_pydantic_core_schema__</code>). The documentation approach requires you to define the <code>core_schema.CoreSchema</code> response directly.</p>
<p>If the third-party type can be easily constructed from the <code>core_schema</code> helper functions (e.g. <code>core_schema.int_schema/str_schema/etc.</code>) or if you need ultimate flexibility in defining the schema, then <code>__get_pydantic_core_schema__</code> approach may be better. However, if the third-party type has many attributes like in the case of <code>relativedelta</code>, I find it more natural to define the shape of the schema using common <code>BaseModel</code> field annotations and overriding using the <code>@model_validator</code> decorator. These approaches aren&rsquo;t mutually exclisive and can be used together.</p>
<p>The example in the documentation also defines a <code>__get_pydantic_json_schema__</code> function. Unless you want to change the JSON schema (for example, to add examples), this function is not required.</p>

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      

      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="/posts/caching-generator-methods-in-python/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Caching Generator Methods in Python</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-12-30 13:25:41 -0500 EST">30 December 2023</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2024
            
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm sm:p-6 md:p-[10vh] lg:p-[12vh] dark:bg-neutral-900/50"
  data-url="https://jrdnh.github.io/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
